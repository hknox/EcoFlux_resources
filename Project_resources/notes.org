Various notes and reminders to myself.

* [[https://chatgpt.com/c/687295f7-4304-8001-b080-4f2e315195eb][ChatGPT discussions]]


* .gitignore/git includes
- **migrations should be in Git** ‚úÖ

1. **Track changes to the database schema over time**
   Just like code, migrations document what changed in your models and when.

2. **Ensure all team members (or production servers) run the same schema**
   If migrations aren‚Äôt in version control, others can‚Äôt apply the same schema changes without guessing.

3. **Enable consistent deployment**
   When deploying (e.g., to production), the migration files ensure Django knows exactly what schema to apply.

---

### üßπ Optional Exception (Don‚Äôt Commit These)

- You *can* ignore auto-generated migration files **during heavy model prototyping**, especially if you're throwing them away frequently ‚Äî but only in isolated branches.
- Once the schema stabilizes, they must be committed.


### summary

| File                                  | Commit to Git?                       |
| ------------------------------------- | ------------------------------------ |
| `Pipfile` / `requirements.txt`        | ‚úÖ Yes                                |
| `migrations/*.py` (not `__pycache__`) | ‚úÖ Yes                                |

Let me know if you‚Äôd like a `.gitignore` template or a typical migration folder structure explanation.


* Deployment
[[https://absolutecodeworks.com/django-web-application-crud-sample-using-mariadb][Example setup for deployment]]
** Managing credentials, devel vs prod settings
Excellent questions ‚Äî these are core concerns when building a Django
app that‚Äôs cleanly portable across **development**, **staging**, and
**production** environments.

Let‚Äôs tackle your two questions:


*** ‚úÖ Q1: How to securely handle secrets like MariaDB credentials in `settings.py`?

- Best practice: **Don't hardcode secrets in `settings.py`**. Use
  environment variables instead and read them in `settings.py`:

```python
import os

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': os.environ.get('DB_NAME', 'default_name'),
        'USER': os.environ.get('DB_USER', 'default_user'),
        'PASSWORD': os.environ.get('DB_PASSWORD', 'default_pass'),
        'HOST': os.environ.get('DB_HOST', 'localhost'),
        'PORT': os.environ.get('DB_PORT', '3306'),
    }
}
```

- In development: set them via `.envrc` or `.env` with `direnv`.
- In production: set them in your Apache virtual host config, or a WSGI wrapper script, or a systemd unit if you're using Gunicorn later.

*** ‚úÖ Q2: How to handle environment-specific settings (dev vs prod) ‚Äî and what to put in Git?

### üî• Best practice: split settings into **base + environment-specific** files.

```
config/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ settings/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py         # usually empty
‚îÇ   ‚îú‚îÄ‚îÄ base.py             # shared by all environments
‚îÇ   ‚îú‚îÄ‚îÄ dev.py              # development overrides
‚îÇ   ‚îî‚îÄ‚îÄ prod.py             # production overrides
```

**Example:**

**base.py:**

```python
# settings/base.py

DEBUG = False
ALLOWED_HOSTS = []
INSTALLED_APPS = [... base apps ...]

# Load from environment variables:
SECRET_KEY = os.environ["DJANGO_SECRET_KEY"]
```

**dev.py:**

```python
from .base import *

DEBUG = True
ALLOWED_HOSTS = ["localhost", "127.0.0.1"]
SECRET_KEY = "insecure-dev-key"

EMAIL_BACKEND = "django.core.mail.backends.console.EmailBackend"
```

**prod.py:**

```python
from .base import *

DEBUG = False
ALLOWED_HOSTS = ["example.com"]

# Secret key comes from environment
SECRET_KEY = os.environ["DJANGO_SECRET_KEY"]
```

**In `.envrc` or Apache env:**

```bash
export DJANGO_SETTINGS_MODULE=config.settings.dev  # or config.settings.prod
```

---

### ‚úÖ What to commit to Git?

**Commit:**

- `config/settings/base.py`, `dev.py`, `prod.py`
- A sample `.envrc` or `.env.example` for local development (no real secrets)

**Don't commit:**

- `.envrc` or `.env` with real secrets
- `.pyc` files, obviously

---

### üîê Optional: use `python-decouple` or `django-environ` to streamline

For more structure and type conversion, you can use packages like:

- [`python-decouple`](https://pypi.org/project/python-decouple/)
- [`django-environ`](https://pypi.org/project/django-environ/)

But raw `os.environ.get()` is totally fine and understandable.

---

## üß© Summary

| Concern                   | Best Practice                                      |
| ------------------------- | -------------------------------------------------- |
| **Secrets**               | Use environment variables (set via `.envrc`, etc.) |
| **Multiple environments** | Split settings into `base.py`, `dev.py`, `prod.py` |
| **Version control**       | Commit example env files; ignore actual secrets    |
| **Ease of switching**     | Use `DJANGO_SETTINGS_MODULE` in `.envrc`           |

---

Let me know if you want a starter `settings` layout scaffold or a `.envrc` template ‚Äî I can build one around your current structure.


** Database
*** Using MariaDb on grandwazoo as a test case.
[[https://www.digitalocean.com/community/tutorials/how-to-use-mysql-or-mariadb-with-your-django-application-on-ubuntu-14-04][
Using MariaDB with Django app]]

[[https://mariadb.com/docs/server/mariadb-quickstart-guides/mariadb-remote-connection-guide][MariaDB doc for remote access]]

see /etc/mysql/mariadb.conf.d/50-server.cnf:

From DuckAI:

"""Using a hostname can be beneficial in environments with dynamic IPs,
but it may introduce a slight delay during the resolution process...
...you do not need to restart the MariaDB server if your dynamic
hostname's IP address changes. MariaDB will automatically resolve the
hostname to the new IP address when connections are made...
...if you want MariaDB to listen on both the specific hostname and
localhost, you would typically use:
  bind-address = 0.0.0.0"""



Use MariaDB only from localhost - install EcoFlux app on sunvillage.

No need to modify bind-address.
Create EcoFlux db (ecoflux)
  CREATE ECOFLUX
Create EcoFlux user and grant privileges
  CREATE USER 'ecoflux'@'' IDENTIFIED BY [password]
  GRANT ALL PRIVILEGES ON ecoflux.* to 'ecoflux''%' (any host!)
  FLUSH PRIVILEGES
  Test by logging on as ecoflux: OK
** Webserver
*** Apache
**** Installation
SUMMARY from Chat:
You don‚Äôt need to install your Django code inside /var/www/html/. Use
a dedicated directory like /srv/ecoflux/, keep ownership as yourself,
and let Apache (via mod_wsgi) serve it securely. pipenv and the
www-data user don‚Äôt need to mix ‚Äî mod_wsgi will handle activating your
virtualenv when configured correctly.

chown -R hank:www-data /srv/ecoflux/
**** Permissions
Best Practices:
Keep ownership as your user (not www-data or root)

Ensure the Apache www-data user can read the Django code and activate
the virtualenv (you‚Äôll do this via mod_wsgi settings)
**** Checklist
***** PREPARE WORKING ENVIRONMENT
x install envrc
x install pipenv
x sudo mkdir /srv/ecoflux/
x cd /srv/ecoflux/
x clone git repo
x chown -R hank:www-data .
x pipenv install
***** CONFIGURE MYSQL ACCESS
x pipenv install mysqlclient (might need to "sudo apt install
  default-libmysqlclient-dev")

x change settings.py and see Chat re/settings.py ideas

Let me know if you want help with:
- splitting settings.py for dev vs prod
- using .env or .envrc for secrets like DB credentials

TEST: python manage.py migrate: OK
Bonus: I loaded fixtures from JoesGarage.

***** CONFIGURE APACHE:
X aptitude install libapache2-mod-wsgi-py3
x a2enmod wsgi
x systemctl restart apache2

create /etc/apache2/sites-available/ecoflux.conf
a2ensite ecoflux.conf
restart apache
python manage.py collectstatic
    setting up mod_wsgi to use the virtualenv properly

**** DONE Changes to settings.py
DATABASES = {
   'default': {
       'ENGINE': 'django.db.backends.mysql',
       'NAME': '<your_database_name>',
       'USER': '<your_database_user>',
       'PASSWORD': '<your_database_password>',
       'HOST': 'localhost',
       'PORT': '',
   }
}
FORCE_SCRIPT_NAME = '/myapp'

STATIC_URL = '/myapp/static/'

**** VirtualHost conf


**** Gunicorn -for later
reverse proxy to Apache or Nginx


* Forms
** Goals
control over layout
control over widgets and behaviour
catch cancel/navigation when page is dirty
add DOI records
add field note records
** [[https://docs.djangoproject.com/en/5.2/topics/][Main Documentation page]]
** Titles for an input yield help text for that input
** Adding attributes to input widgets using crispy Layout
Field: can add arbitrary attributes to input widgets using keyword
assignments, eg 'rows=4', 'cols=25', etc.
** multipart/form-data
This is automatically set when the form needs this enctype, so there
is no official crispy-layout helper attribute for it.

** [[https://www.youtube.com/watch?v=X8ECf3Ow3ww][Intro to crispy-forms (YouTube)]]
** FormHelper attributes
From ChatGPT:
üîç What do all these helper attributes do?
Attribute	Purpose
form_class	Applied to the <form> element. Common value: "row g-3" for Bootstrap 5 horizontal layout.
label_class	Applied to all <label> elements. Controls label width and alignment.
field_class	Applied to the container <div> around each field (not the input itself). Controls how wide the field area is.
wrapper_class	Applied to the outer wrapper div of each field-label pair (the whole row). Optional but useful for spacing (mb-3, etc.).

(Summary 2:)
form_class: "row g-3" sets Bootstrap horizontal layout with spacing
label_class: aligns and sizes labels (left column)
field_class: sizes input area (right column)

wrapper_class="mb-3": adds vertical spacing between rows (optional but nice)
üîÑ Summary of customization points
    form_class: "row g-3" sets Bootstrap horizontal layout with spacing
    label_class: aligns and sizes labels (left column)
    field_class: sizes input area (right column)
    wrapper_class="mb-3": adds vertical spacing between rows (optional but nice)

‚úÖ Summary: What can be overridden per field?
Attribute	Set Globally (on FormHelper)	Override Per Field (Field(...))
form_class	‚úÖ Yes	üö´ No (applies to <form>)
label_class	‚úÖ Yes	‚úÖ Yes (via Field(..., wrapper_class=...) or css_class tricks)
field_class	‚úÖ Yes	‚úÖ Yes (Field(..., wrapper_class=...))
wrapper_class	‚úÖ Yes	‚úÖ Yes (Field(..., wrapper_class=...))

Note: form_class applies to the <form> element, so it's always global.

üß† Bonus: You can also use Div(...) for more control
This is handy for grouping fields or overriding column layout per row.

Adding form-control to all fields:
Method	Best Use Case
__init__() loop	                        Medium/large forms with consistency
Meta.widgets	                        Few fields, specific overrides
crispy-forms + {% crispy form %}	Automatic Bootstrap styling
** ChatGPT overview of dirty-form protection  options
...what you‚Äôre describing is a pretty common UX pain point with Django
‚Äúdetail + related records‚Äù pages, and you‚Äôre right that just making
Equipment or FieldNotes part of the main Site formset is the wrong fit
if you need their full create forms.

There are a few patterns that work well here, and the ‚Äúdirty form‚Äù
warning is the main challenge to solve.

*** 1. Open the Create form in a modal (Bootstrap modal or similar)**

- You can keep the Site form open and ‚Äúdirty‚Äù in the background.
- Clicking ‚ÄúAdd Equipment‚Äù triggers JavaScript to load the `CreateView` form into a Bootstrap modal via AJAX.
- When the modal form is submitted (via AJAX), the server:

  * Creates the Equipment or FieldNote instance.
  * Returns a JSON response with the rendered row for the updated list (or the updated list HTML).
  * JavaScript then injects the new row into the Equipment or FieldNote table without a full page reload.
 **Benefits**: No dirty form warning, user stays on page.
 **Downsides**: You have to AJAXify your CreateView (but you can keep the regular non-AJAX view for fallback).

*** 2. Open Create form in a new browser tab**

- ‚ÄúAdd Equipment‚Äù link uses `target="_blank"`.
- User fills out the new item in a separate tab.
- After saving, they close the tab and return to the original Site page ‚Äî which still has their unsaved changes.
 **Benefits**: No dirty form prompt.
 **Downsides**: Slightly clunky UX; users must be comfortable with multiple tabs.

*** 3. Save the Site form automatically before opening Create**

- When ‚ÄúAdd Equipment‚Äù is clicked:

  * JavaScript first sends an AJAX POST to save the Site form.
  * If successful, it redirects to the CreateView for Equipment/FieldNote, already knowing the saved Site PK.
 **Benefits**: Keeps the workflow single-page without modal complexity.
 **Downsides**: Might commit partially-complete Site data before the user is ready.

*** 4. Use an inline modal form but *not* a formset**

- Instead of a separate CreateView, render a full form for Equipment/FieldNote *inside* a modal on the Site page.
- Submit it via AJAX to the standard CreateView endpoint.
- Refresh the relevant list with the new item after save.
 **Benefits**: Keeps full control of fields; no partial formset.
 **Downsides**: You need to load the form via AJAX and re-render errors if validation fails.

*** Recommendation for your case**

Given:

- You want the full CreateView fields for Equipment/FieldNote.
- You don‚Äôt want to lose Site form changes.
- You already have a dirty-form warning system.

I‚Äôd go with option 1** ‚Äî Bootstrap modal + AJAX form submission.
It avoids the dirty form prompt, keeps UX smooth, and works with your existing CreateView with only a little refactoring to handle AJAX.

But in the end I went with opton 3, save dirty site

** Container margins, gaps, padding
default: containers have left and right padding
** [[https://docs.djangoproject.com/en/5.2/topics/forms/formsets/][Formsets]]
** [[https://docs.djangoproject.com/en/5.2/topics/forms/modelforms/#model-formsets][Modelformsets]]
** [[https://docs.djangoproject.com/en/5.2/ref/forms/widgets/][Django widget docs]]
How to add CSS classes to widgets in Python
** [[https://docs.djangoproject.com/en/5.2/ref/forms/api/#binding-uploaded-files-to-a-form][Uploading files to a form]]




* Bootstrap notes


* MDN exploration
** To pick up later
- Forms and buttons
- Table challenge: Planets Data





* novalidate
Re: 'novalidate' attribute: See https://docs.djangoproject.com/en/5.2/topics/forms/:

"If your form includes a URLField, an EmailField or any integer field
type, Django will use the url, email and number HTML5 input types. By
default, browsers may apply their own validation on these fields,
which may be stricter than Django‚Äôs validation. If you would like to
disable this behavior, set the novalidate attribute on the form tag,
or specify a different widget on the field, like TextInput."

Without it the saved-data check fails to run.



* HTML notes
Using an href="?site=4.." reloads the current site using this as a
query string.


* [[https://learndjango.com/tutorials/django-favicon-tutorial][Adding favicons in Django]]


* template hierarchies
common template inheritance hierarchy
- Create a base.html template that holds the main look-and-feel of your site.
- Create a base_SECTIONNAME.html template for each ‚Äúsection‚Äù of your
  site. For example, base_news.html, base_sports.html. These templates
  all extend base.html and include section-specific styles/design.
- Create individual templates for each type of page, such as a news
  article or blog entry. These templates extend the appropriate
  section template.
** bootstrap5 hierarchies
   [[https://docs.djangoproject.com/en/5.1/ref/templates/language/][Documentation: template language]]
- django_bootstrap5/bootstrap5.html: basic bootstrap configuration
  offers several blocks to override:
  - bootstrap5_title
  - bootstrap5_before_content
  - bootstrap5_content
  - bootstrap5_after_content
  - bootstrap5_extra_script
  templates further down set the above variables
** django_bootstrap-example hierarchies
- bootstrap.html extends django_boostrap5/bootstrap5.html
  offers title block and sets bootstrap5_title to title
- base.html extends bootstrap.html
  offers blocks to override:
  - title
  - content
  Sets up a navigation bar with links, NOT fixed position (floats with
  content), shows any bootstrap_messages (set in view)
 - home.html extends base.html
   sets title, content blocks




* Configuration
#+TODO: TODO(t) NEXTACTION(n) STARTED(s) WAITING(w) | DONE(d) CANCELED(c) DEFERRED(f)
