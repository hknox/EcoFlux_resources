{% extends "inventory/layout_base.html" %}

<head>
  {% load django_bootstrap5 %}
  {% load crispy_forms_tags static %}

  {% block extra_css %}
  {% endblock %}

</head>

<body>
  {% block page_heading %} - {{action}} Equipment{% endblock %}

  {% block content %}

  <form id="id_equipment_form" class = "mt-3 track-unsaved form-class"
  data-form-name="Equipment form" novalidate method="post">

    {% csrf_token %}
    <input type="hidden" name="next" value="{{ request.GET.next|default:'' }}">
    {% crispy form %}


    <!-- History formset -->
    <div class="d-flex align-items-stretch accordion">
      <button class="p-2 text-bg-info accordion-button collapsed flex-grow-1"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#historyCollapse"
              aria-expanded="false"
              aria-controls="historyCollapse">
        History
      </button>
      <button type="button"
              class="btn btn-info d-flex align-items-center rounded-0 text-nowrap add-form-row"
              data-formset-prefix="{{ history_formset.prefix }}">
        <i class="bi bi-plus-circle me-1"></i> Add a History record
      </button>
    </div>

    <div id="historyCollapse"
         class="accordion-collapse collapse"
         aria-labelledby="historyHeading">
      <div class="accordion-body">
        {% if not history_formset.forms %}
        <div type="row" class="mt-2">No history records yet.</div>
        {% endif %}
        {% include "inventory/include/formset_block.html" with formset=history_formset %}
      </div>
    </div>

    {% include "inventory/include/messages.html" %}

    <!-- Save/Cancel/Delete buttons -->
    {% include "inventory/include/save_cancel_delete.html" %}

  </form>

  {% endblock content %}

  {% block extra_js %}

  {% include "inventory/include/flatpickr.html" %}
  {# NB important: formset_add.js must load AFTER form_protect.js #}
  <script src="{% static 'js/formset_add.js' %}"></script>
  <script src="{% static 'js/delete_button.js' %}"></script>


  {% endblock extra_js %}
</body>
